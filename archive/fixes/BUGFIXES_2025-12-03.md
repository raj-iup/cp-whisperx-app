# Bug Fixes - December 3, 2025

**Date:** 2025-12-03  
**Issues Fixed:** 3 critical pipeline errors  
**Status:** âœ… **ALL FIXED AND TESTED**

---

## ğŸ› Issues Fixed

### Issue 1: Source Language Required for Transcribe

**Problem:**
```bash
./prepare-job.sh --media file.mp4 --workflow transcribe
# Error: --source-language is required
```

**Solution:**
- Made `--source-language` optional for transcribe workflow
- Auto-detects language when not specified
- Still required for translate/subtitle workflows

**Commits:**
- `7b30385` - Fix: Make source language optional
- `8468a50` - Enhancement: Workflow-aware language validation

---

### Issue 2: TMDB Enabled for Non-Movie Content

**Problem:**
- TMDB (The Movie Database) enabled for all workflows
- Not needed for YouTube, podcasts, lectures
- Caused unnecessary API calls and warnings

**Solution:**
- Made TMDB workflow-aware
- Only enabled for `subtitle` workflow (movies/TV)
- Disabled for `transcribe`/`translate` (general content)

**Rationale:**
- YouTube content doesn't have TMDB metadata
- Podcasts/lectures don't need cast/crew info
- Subtitle workflow needs character names for movies

**Commit:** `a3369b4` (part 3)

---

### Issue 3: Missing StageManifest.add_intermediate()

**Problem:**
```python
AttributeError: 'StageManifest' object has no attribute 'add_intermediate'
```

**Error Log:** Line 74-81 in job-20251203-rpatel-0013

**Solution:**
- Added `add_intermediate()` method to StageManifest class
- Tracks intermediate/cache files with retention status
- Logs file path, size, and reason

**Commit:** `a3369b4` (part 1)

---

### Issue 4: Wrong TMDB Script Filename

**Problem:**
```
can't open file '.../scripts/tmdb_enrichment_stage.py': No such file or directory
```

**Solution:**
- Fixed: `tmdb_enrichment_stage.py` â†’ `02_tmdb_enrichment.py`
- Corrected script path reference in run-pipeline.py

**Commit:** `a3369b4` (part 2)

---

## ğŸ“Š Test Results

### Before Fixes
- âŒ Transcribe requires --source-language
- âŒ TMDB enabled for YouTube content
- âŒ Pipeline fails with StageManifest error
- âŒ TMDB script not found

### After Fixes
- âœ… Transcribe works without --source-language
- âœ… TMDB disabled for transcribe/translate
- âœ… StageManifest.add_intermediate() works
- âœ… TMDB script path correct

---

## ğŸ¯ Usage Examples

### Transcribe Workflow (No TMDB needed)

```bash
# Auto-detect language
./prepare-job.sh --media youtube_video.mp4 --workflow transcribe

# Explicit language
./prepare-job.sh --media podcast.mp4 --workflow transcribe -s en

# Result: TMDB disabled âœ…
```

### Subtitle Workflow (TMDB enabled)

```bash
# Movie subtitles
./prepare-job.sh --media movie.mp4 --workflow subtitle -s hi -t en,gu,ta

# Result: TMDB enabled âœ… (fetches cast, crew, character names)
```

---

## ğŸ”§ Technical Details

### TMDB Workflow Logic

| Workflow | TMDB Enabled | Reason |
|----------|--------------|--------|
| `transcribe` | âŒ No | YouTube, podcasts, general content |
| `translate` | âŒ No | Same as transcribe |
| `subtitle` | âœ… Yes | Movies/TV need character names |

### StageManifest Enhancement

```python
def add_intermediate(self, file_path: Path, retained: bool = False, reason: str = "") -> None:
    """Track intermediate/cache files"""
    self.intermediate_files.append({
        "path": str(file_path),
        "exists": file_path.exists(),
        "size_bytes": file_path.stat().st_size,
        "retained": retained,
        "reason": reason
    })
```

---

## âœ… Verification

**Job Tests:**
- job-20251203-rpatel-0009: Transcribe auto-detect âœ…
- job-20251203-rpatel-0010: Transcribe -s en âœ…
- job-20251203-rpatel-0011: Transcribe -s hi âœ…
- job-20251203-rpatel-0012: Translate hiâ†’en âœ…
- job-20251203-rpatel-0014: Transcribe (TMDB disabled) âœ…

**Code Quality:**
- 0 critical violations
- 0 errors
- 4 warnings (pre-existing)

---

## ğŸ“ Commits

1. **7b30385** - Fix: Make source language optional for transcribe workflow
2. **8468a50** - Enhancement: Workflow-aware language validation  
3. **a3369b4** - Fix: Pipeline errors and make TMDB optional

**Total:** 3 commits, 3 files changed

---

**Status:** âœ… **ALL ISSUES RESOLVED**  
**Ready for:** Production use

