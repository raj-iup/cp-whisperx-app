# Technical Requirement Document

**Document ID:** TRD-012  
**Related BRD:** BRD-012  
**Title:** Centralized Log Management System  
**Version:** 1.0  
**Date:** 2025-12-08  
**Status:** ⏳ Planned  
**Author:** System Architect

---

## 1. Technical Summary

Implement a centralized log management system that organizes all logs (testing, debugging, development, CI/CD) in a structured `logs/` directory hierarchy. This prevents project root clutter and improves log discoverability through standardized naming and organization patterns.

**Related AD:** AD-012 (Centralized Log Management)

---

## 2. Related Business Requirements

**From BRD-012:**
- FR-001: All logs written to `logs/` directory (never project root)
- FR-002: Standardized log naming: `YYYYMMDD_HHMMSS_{context}_{operation}.log`
- FR-003: Helper function `get_log_path(category, context, operation)` for consistent paths
- FR-004: Automatic log directory creation
- NFR-001: Clean project root (no loose log files)
- NFR-002: Easy log discovery and cleanup

---

## 3. Technical Architecture

### 3.1 Log Directory Structure

```
logs/
├─ testing/
│  ├─ unit/                    # Unit test logs
│  ├─ integration/             # Integration test logs
│  ├─ functional/              # E2E test logs
│  └─ manual/                  # Manual test script logs
│     └─ 20251208_103045_transcribe_mlx.log
│
├─ development/
│  ├─ debug/                   # Debug session logs
│  ├─ experiments/             # Experimental feature logs
│  └─ profiling/               # Performance profiling logs
│
├─ ci-cd/
│  ├─ github-actions/          # CI/CD pipeline logs
│  └─ pre-commit/              # Pre-commit hook logs
│
└─ archive/                     # Old logs (auto-cleanup after 30 days)
```

### 3.2 Log Path Helper

```python
# shared/log_paths.py

from pathlib import Path
from datetime import datetime

def get_log_path(category: str, context: str, operation: str) -> Path:
    """
    Get standardized log file path.
    
    Args:
        category: 'testing', 'development', 'ci-cd'
        context: Subcategory ('unit', 'debug', 'github-actions', etc.)
        operation: What's being logged ('transcribe', 'mlx', etc.)
    
    Returns:
        Path to log file: logs/{category}/{context}/YYYYMMDD_HHMMSS_{operation}.log
    
    Example:
        >>> get_log_path("testing", "manual", "transcribe_mlx")
        Path('logs/testing/manual/20251208_103045_transcribe_mlx.log')
    """
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    log_dir = Path("logs") / category / context
    log_dir.mkdir(parents=True, exist_ok=True)
    
    log_name = f"{timestamp}_{operation}.log"
    return log_dir / log_name
```

---

## 4. Technical Requirements

### TR-001: Log Path Helper Function
**Priority:** High  
**Related FR:** FR-003, FR-004  
**Description:** Centralized function for generating log paths  
**Implementation:** `shared/log_paths.py` module

**Acceptance Criteria:**
- [ ] `get_log_path()` function implemented
- [ ] Automatic directory creation
- [ ] Standardized naming format
- [ ] Type hints and docstring

**Status:** ⏳ Not Started

### TR-002: Project-Wide Log Path Migration
**Priority:** High  
**Related FR:** FR-001  
**Description:** Update all scripts to use centralized log paths  
**Implementation:** Audit and update all log file creation

**Current Violations:**
```bash
# Project root log files to migrate:
logs/
test-*.log                     # Manual test logs
debug-*.log                    # Debug session logs
experiment-*.log               # Experiment logs
```

**Migration Pattern:**
```python
# ❌ OLD - Writing to project root
log_file = "test-transcribe.log"
with open(log_file, 'w') as f:
    subprocess.run(cmd, stdout=f, stderr=subprocess.STDOUT)

# ✅ NEW - Using centralized log management
from shared.log_paths import get_log_path

log_file = get_log_path("testing", "manual", "transcribe_mlx")
with open(log_file, 'w') as f:
    subprocess.run(cmd, stdout=f, stderr=subprocess.STDOUT)
```

**Acceptance Criteria:**
- [ ] All test scripts use `get_log_path()`
- [ ] All debug scripts use `get_log_path()`
- [ ] No logs written to project root
- [ ] .gitignore updated for logs/ directory

**Status:** ⏳ Not Started

### TR-003: Log Cleanup Automation
**Priority:** Medium  
**Related FR:** NFR-002  
**Description:** Automatic archival and cleanup of old logs  
**Implementation:** Periodic cleanup script

**Rules:**
- Logs older than 30 days → Move to `logs/archive/`
- Archived logs older than 90 days → Delete
- Keep recent logs for quick access

**Implementation:**
```bash
# tools/cleanup-logs.sh
#!/bin/bash

# Archive logs older than 30 days
find logs/ -type f -name "*.log" -mtime +30 -exec mv {} logs/archive/ \;

# Delete archived logs older than 90 days
find logs/archive/ -type f -name "*.log" -mtime +90 -delete

echo "✅ Log cleanup complete"
```

**Acceptance Criteria:**
- [ ] Cleanup script implemented
- [ ] Configurable retention periods
- [ ] Safe deletion (dry-run mode)
- [ ] Scheduled via cron (optional)

**Status:** ⏳ Not Started

### TR-004: Documentation Updates
**Priority:** Medium  
**Description:** Update docs with log management patterns  
**Implementation:** Add to developer standards and quickstart guides

**Acceptance Criteria:**
- [ ] AD-012 added to Copilot Instructions
- [ ] Log paths section in DEVELOPER_STANDARDS.md
- [ ] Examples in CODE_EXAMPLES.md
- [ ] Quickstart guide updated

**Status:** ⏳ Not Started

---

## 5. Implementation Phases

### Phase 1: Foundation (⏳ Week 1)
- [ ] Create `shared/log_paths.py` module
- [ ] Implement `get_log_path()` function
- [ ] Write unit tests
- [ ] Document usage patterns

### Phase 2: Migration (⏳ Week 1-2)
- [ ] Audit all log file creation
- [ ] Migrate test scripts
- [ ] Migrate debug scripts
- [ ] Update .gitignore

### Phase 3: Automation (⏳ Week 2)
- [ ] Create cleanup script
- [ ] Test cleanup logic
- [ ] Document cleanup process

### Phase 4: Documentation (⏳ Week 2)
- [ ] Update developer standards
- [ ] Add to copilot instructions
- [ ] Create usage examples

---

## 6. Testing Strategy

### 6.1 Unit Tests

```python
def test_get_log_path():
    """Test log path generation"""
    log_path = get_log_path("testing", "unit", "test_feature")
    
    # Check structure
    assert str(log_path).startswith("logs/testing/unit/")
    assert str(log_path).endswith("_test_feature.log")
    
    # Check directory created
    assert log_path.parent.exists()

def test_log_path_unique():
    """Different calls produce different paths"""
    path1 = get_log_path("testing", "unit", "test1")
    path2 = get_log_path("testing", "unit", "test2")
    
    assert path1 != path2
```

### 6.2 Integration Tests

```bash
# Test script log generation
./tests/manual/test-transcribe.sh
# Expected: Log in logs/testing/manual/YYYYMMDD_HHMMSS_transcribe.log

# Verify no project root logs
ls -1 *.log 2>/dev/null | wc -l
# Expected: 0
```

---

## 7. Related Architectural Decisions

**AD-012:** Centralized Log Management  
**Why:** Clean project root, improve log discoverability

**Dependencies:**
- AD-013 (Test Organization): Logs organized similarly to tests

**Impact:**
- Cleaner project structure
- Easier log discovery
- Better CI/CD log management

---

## 8. Success Metrics

| Metric | Target | Actual | Status |
|--------|--------|--------|--------|
| Project root logs | 0 files | Unknown | ⏳ Not measured |
| Log path helper adoption | 100% | 0% | ⏳ Not started |
| Documentation complete | 100% | 0% | ⏳ Not started |
| Implementation time | 1-2 hours | N/A | ⏳ Not started |

---

## 9. Related Documents

- **BRD:** [BRD-012](../brd/BRD-012.md)
- **Architecture:** [AD-012 in ARCHITECTURE.md](../ARCHITECTURE.md)
- **Standards:** [DEVELOPER_STANDARDS.md](../developer/DEVELOPER_STANDARDS.md)

---

## 10. Change History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2025-12-08 | System Architect | Initial TRD creation |
