#!/bin/bash
# Pipeline Quick Reference
# Run this to see pipeline status and available commands

echo "======================================================"
echo "   CP-WhisperX Pipeline - Quick Reference"
echo "======================================================"
echo ""

echo "ğŸ“Š PIPELINE STAGES (Sequential)"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "  1. demux          â†’ Extract 16kHz mono audio"
echo "  2. tmdb           â†’ Fetch movie metadata"
echo "  3. pre-ner        â†’ Extract entities for prompt"
echo "  4. silero-vad     â†’ Coarse speech segmentation"
echo "  5. pyannote-vad   â†’ Refined VAD boundaries"
echo "  6. diarization    â†’ Speaker labeling"
echo "  7. asr            â†’ WhisperX transcription"
echo "  8. post-ner       â†’ Entity correction"
echo "  9. subtitle-gen   â†’ Generate .srt subtitles"
echo " 10. mux            â†’ Embed subtitles in MP4"
echo ""

echo "ğŸš€ COMMON COMMANDS"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "  Preflight check:       python preflight.py"
echo "  Build all images:      docker compose build"
echo "  Run complete pipeline: python pipeline.py in/movie.mp4"
echo "  Run single stage:      docker compose run --rm <stage> <args>"
echo ""

echo "ğŸ—ï¸  DOCKER IMAGES STATUS"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
docker images | grep "cp-whisperx-app" | awk '{printf "  %-30s %10s  %10s\n", $1, $4" "$5, $7}'
echo ""

echo "ğŸ“ OUTPUT STRUCTURE"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "  out/{Movie_Title}/"
echo "  â”œâ”€â”€ audio/audio.wav"
echo "  â”œâ”€â”€ metadata/tmdb_data.json"
echo "  â”œâ”€â”€ entities/pre_ner.json"
echo "  â”œâ”€â”€ vad/silero_segments.json"
echo "  â”œâ”€â”€ vad/pyannote_segments.json"
echo "  â”œâ”€â”€ diarization/speaker_segments.json"
echo "  â”œâ”€â”€ transcription/transcript.json"
echo "  â”œâ”€â”€ entities/post_ner.json"
echo "  â”œâ”€â”€ subtitles/subtitles.srt"
echo "  â”œâ”€â”€ final_output.mp4"
echo "  â””â”€â”€ manifest.json"
echo ""

echo "â±ï¸  STAGE TIMEOUTS"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "  demux:        10 min   |  pre-ner:      5 min"
echo "  tmdb:          2 min   |  silero-vad:  30 min"
echo "  pyannote-vad: 60 min   |  diarization: 30 min"
echo "  asr:          60 min   |  post-ner:    10 min"
echo "  subtitle-gen:  5 min   |  mux:         10 min"
echo ""

echo "ğŸ”§ INDIVIDUAL STAGE EXAMPLES"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "  docker compose run --rm demux in/movie.mp4"
echo "  docker compose run --rm tmdb \"Movie Title\" 2024"
echo "  docker compose run --rm pre-ner out/Movie_Title"
echo "  docker compose run --rm asr out/Movie_Title"
echo "  docker compose run --rm mux in/movie.mp4 out/Movie_Title/subtitles/subtitles.srt out/Movie_Title/final.mp4"
echo ""

echo "ğŸ“– DOCUMENTATION"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "  Full guide:     docs/PIPELINE_REBUILD.md"
echo "  Architecture:   arch/workflow-arch.txt"
echo "  Logs:           logs/"
echo ""

echo "âœ… Ready to run pipeline!"
echo "   Next: python pipeline.py in/your-movie.mp4"
echo ""
