# cp-whisperx-app Pipeline Configuration
# All pipeline steps read from this file

# ============================================================
# INPUT / OUTPUT
# ============================================================
IN_ROOT=/Users/rpatel/Projects/cp-whisperx-app/jobs/2025/11/02/20251102-0008/Jaane Tu Ya Jaane Na 2008.mp4
JOB_ID=20251102-0008
USER_ID=1
OUTPUT_ROOT=out/2025/11/02/20251102-0008
LOG_ROOT=out/2025/11/02/20251102-0008/logs
LOG_LEVEL=debug

# ============================================================
# SECRETS & METADATA
# ============================================================
SECRETS_PATH=./config/secrets.json
SPEAKER_MAP=
CANON_MAP=./canon_map.yaml

# ============================================================
# PIPELINE CONTROL
# ============================================================
# Enable/disable pipeline steps
STEP_DEMUX=true
STEP_VAD_SILERO=true
STEP_VAD_PYANNOTE=true
STEP_WHISPERX=true
STEP_DIARIZATION=true
STEP_TMDB_METADATA=true
STEP_SUBTITLE_GEN=true
STEP_MUX=true

# ============================================================
# Bias window (seconds)
# ============================================================
WINDOW_SECONDS=45
STRIDE_SECONDS=15
BIAS_TOPK=10
BIAS_DECAY=0.9

# ============================================================
# FFMPEG DEMUX SETTINGS
# ============================================================
AUDIO_SAMPLE_RATE=16000
AUDIO_CHANNELS=1
AUDIO_FORMAT=wav

# ============================================================
# VAD SETTINGS
# ============================================================
# Silero VAD
SILERO_THRESHOLD=0.5
SILERO_MIN_SPEECH_DURATION_MS=250
SILERO_MIN_SILENCE_DURATION_MS=100

# PyAnnote VAD
PYANNOTE_ONSET=0.5
PYANNOTE_OFFSET=0.5
PYANNOTE_MIN_DURATION_ON=0.0
PYANNOTE_MIN_DURATION_OFF=0.0

# ============================================================
# WHISPERX ASR SETTINGS
# ============================================================
WHISPER_MODEL=large-v3
WHISPER_COMPUTE_TYPE=int8
WHISPER_BATCH_SIZE=16
WHISPER_LANGUAGE=hi
WHISPER_TASK=translate
WHISPER_INITIAL_PROMPT=

# ============================================================
# DIARIZATION SETTINGS
# ============================================================
DIARIZATION_MIN_SPEAKERS=1
DIARIZATION_MAX_SPEAKERS=20
SPEAKER_MAP=

# ============================================================
# TMDB METADATA SETTINGS
# ============================================================
TMDB_ENABLED=true
TMDB_LANGUAGE=en-US
INFER_TMDB_FROM_FILENAME=true

# ============================================================
# SUBTITLE GENERATION SETTINGS
# ============================================================
SUBTITLE_FORMAT=srt
SUBTITLE_MAX_LINE_LENGTH=42
SUBTITLE_MAX_LINES=2
INCLUDE_SPEAKER_LABELS=true
SPEAKER_LABEL_FORMAT=[{speaker}]

# ============================================================
# FFMPEG MUX SETTINGS
# ============================================================
SUBTITLE_CODEC=mov_text
SUBTITLE_LANGUAGE=eng
SUBTITLE_TITLE=English

# ============================================================
# DEVICE SETTINGS
# ============================================================
DEVICE=mps

# ============================================================
# ADVANCED SETTINGS
# ============================================================
# Chunking for large files
ENABLE_CHUNKING=false
CHUNK_DURATION_MINUTES=30

# Docker
DOCKER_MEMORY_LIMIT=10g
DOCKER_CPU_LIMIT=4

# Second pass translator
SECOND_PASS_ENABLED=true
SECOND_PASS_BACKEND=opus-mt

# Question generation (QG)
QG_ENABLED=true
QG_THRESHOLD=0.8
QG_FALLBACKS=true

# Lyrics detection
LYRIC_DETECT_ENABLED=true
LYRIC_THRESHOLD=0.5
LYRIC_STYLE=lyric

# NER
NER_ENABLED=true
NER_PRESET=en_core_web_trf

# Languages / output
SRC_LANG=hi
TGT_LANG=en
OUTPUT_PLAINTEXT=false
